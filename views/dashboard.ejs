<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Admin - FMCarer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f6f4fa;
            color: #333;
        }

        .navbar {
            background-color: #722dd3;
        }

        .navbar-brand, .navbar .btn {
            color: #fff !important;
        }

        .admin-card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            display: flex;
            align-items: center;
        }

        .admin-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            border: 3px solid #1e88e5;
        }

        .dashboard-grid .card {
            transition: all 0.2s ease-in-out;
        }

        .dashboard-grid .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .notification-badge {
            background-color: #e53935;
            color: #fff;
            border-radius: 999px;
            padding: 3px 8px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: 8px;
            right: 12px;
            display: none;
        }

        .notification-badge.show {
            display: inline-block;
        }

        .dashboard-icon {
            font-size: 24px;
            color: #722dd3;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <span class="navbar-brand fw-bold">Trang Qu·∫£n Tr·ªã FMCarer</span>
        <form class="d-flex" method="POST" action="/admin/logout">
            <button class="btn btn-danger">ƒêƒÉng xu·∫•t</button>
        </form>
    </div>
</nav>

<div class="container py-4">

    <% if (admin) { %>
        <div class="admin-card mb-4">
            <img src="<%= admin.image || 'https://placehold.co/80x80/722DD3/FFFFFF?text=Admin' %>" alt="Avatar" class="admin-avatar" />
            <div>
                <h5 class="mb-1"><%= admin.fullname || admin.username %></h5>
                <small class="text-muted">Vai tr√≤: <%= admin.role || 'Admin' %></small>
            </div>
        </div>
    <% } else { %>
        <div class="alert alert-danger">Kh√¥ng t√¨m th·∫•y th√¥ng tin admin</div>
    <% } %>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 dashboard-grid">

        <div class="col">
            <a href="/admin/users" class="card p-3 position-relative text-decoration-none h-100">
                <div class="notification-badge" id="user-notification"></div>
                <div class="dashboard-icon">üë•</div>
                <h5 class="mt-2">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h5>
                <p class="mb-0 text-muted">Xem v√† duy·ªát danh s√°ch ph·ª• huynh</p>
            </a>
        </div>

        <div class="col">
            <a href="/admin/posts" class="card p-3 position-relative text-decoration-none h-100">
                <div class="notification-badge" id="post-notification"></div>
                <div class="dashboard-icon">üìù</div>
                <h5 class="mt-2">Qu·∫£n l√Ω b√†i vi·∫øt</h5>
                <p class="mb-0 text-muted">Duy·ªát, ch·ªânh s·ª≠a ho·∫∑c xo√° b√†i vi·∫øt</p>
            </a>
        </div>

        <div class="col">
            <a href="/admin/reminders" class="card p-3 position-relative text-decoration-none h-100">
                <div class="notification-badge" id="reminder-notification"></div>
                <div class="dashboard-icon">üìÖ</div>
                <h5 class="mt-2">Qu·∫£n l√Ω nh·∫Øc nh·ªü</h5>
                <p class="mb-0 text-muted">Th·ªëng k√™ c√°c nh·∫Øc nh·ªü quan tr·ªçng</p>
            </a>
        </div>

        <div class="col">
            <a href="/admin/statistics" class="card p-3 position-relative text-decoration-none h-100">
                <div class="dashboard-icon">üìä</div>
                <h5 class="mt-2">Th·ªëng k√™ h·ªá th·ªëng</h5>
                <p class="mb-0 text-muted">Xem t·ªïng s·ªë ng∆∞·ªùi d√πng, b√†i vi·∫øt, tr·∫ª em</p>
            </a>
        </div>

        <div class="col">
            <a href="/admin/settings" class="card p-3 position-relative text-decoration-none h-100">
                <div class="dashboard-icon">‚öôÔ∏è</div>
                <h5 class="mt-2">C√†i ƒë·∫∑t h·ªá th·ªëng</h5>
                <p class="mb-0 text-muted">C·∫≠p nh·∫≠t c·∫•u h√¨nh, vai tr√≤ ng∆∞·ªùi d√πng</p>
            </a>
        </div>

    </div>

</div>

<script>
    async function fetchNotifications() {
        try {
            const [userRes, postRes, reminderRes] = await Promise.all([
                fetch('/admin/api/notifications/users'),
                fetch('/admin/api/notifications/posts'),
                fetch('/admin/api/notifications/reminders')
            ]);
            const userData = await userRes.json();
            const postData = await postRes.json();
            const reminderData = await reminderRes.json();

            updateBadge('user-notification', userData.count);
            updateBadge('post-notification', postData.count);
            updateBadge('reminder-notification', reminderData.count);
        } catch (err) {
            console.error('L·ªói t·∫£i th√¥ng b√°o:', err);
        }
    }

    function updateBadge(id, count) {
        const el = document.getElementById(id);
        if (el) {
            if (count > 0) {
                el.textContent = count;
                el.classList.add('show');
            } else {
                el.textContent = '';
                el.classList.remove('show');
            }
        }
    }

    document.addEventListener('DOMContentLoaded', fetchNotifications);
</script>

</body>
</html>
